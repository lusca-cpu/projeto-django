{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Framework{% endblock%}

{% block content %}
<main>                
    <div class="d-flex mb-3" style="margin-top: 50px; margin-left: 45px">
        <button type="button" class="btn btn-primary btn-sm font-small text-center d-flex align-items-center justify-content-center me-2" data-bs-toggle="modal" data-bs-target="#uploadModal">
            <svg width="16" height="16" fill="currentColor" class="bi bi-download me-1" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
            </svg>
            Modelo Planilha
        </button>
        <button type="button" class="btn btn-primary btn-sm font-small text-center d-flex align-items-center justify-content-center" data-bs-toggle="modal" data-bs-target="#uploadModal">
            <svg width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill me-1" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3z"/>
            </svg>
            Novo framework
        </button>
    </div>
    <div>
        <!-- Desenho da tabela a ser implementado -->
        <div class="table-responsive font-middle px-5">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col"></th>
                        <th scope="col">Framework</th>
                        <th scope="col" class="col-lg">Descrição</th>
                        <th scope="col" class="col-2">Critério Avaliação</th>
                        <th scope="col">Data de Atualização</th>
                        <th scope="col">Adicionado por</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td>NIST CSF 2.0</td>
                        <td >Diretrizes e melhores práticas para gerenciar e reduzir riscos cibernéticos, com foco em identificação, proteção, detecção, resposta e recuperação.​</td>
                        <td>CMMI</td>
                        <td>XX.XX.XXXX</td>
                        <td>Empresa - Usuário</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>CIS Controls v8.1</td>
                        <td>Conjunto de 18 controles de segurança prioritários que ajudam as organizações a defender-se contra ameaças cibernéticas mais comuns, com ênfase na implementação prática e mensurável.​​</td>
                        <td>Binário (sim/não)</td>
                        <td>XX.XX.XXXX</td>
                        <td>Empresa - Usuário</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>ISO 27000</td>
                        <td>Padrões que fornece requisitos e orientações para estabelecer, implementar, manter e melhorar um sistema de gestão de segurança da informação (SGSI).​​</td>
                        <td>Conforme (C) <br/>
                            Conforme Parcialmente (CP) <br/>
                            Não Conforme (NC)</td>
                        <td>XX.XX.XXXX</td>
                        <td>Empresa - Usuário</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="icon-container" style="display: flex; gap: 10px;">
                                <!-- Botão para abrir o modal editar framework -->
                                <span data-bs-toggle="modal" data-bs-target="#editarFrameworkModal">
                                    <svg class="bi-gear-fill" viewBox="0 0 16 16">
                                        <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                    </svg>
                                </span>                                
                                <!-- Borão para excluir framework -->
                                <span data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                                    <svg class="bi-gear-fill" viewBox="0 0 16 16">
                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                    </svg>
                                </span>
                                <!-- Botão para abrir o download -->
                                <span id="downloadIcon" onclick="window.location.href='{% url 'download_file' 'teste.xls' %}'">
                                    <svg class="bi-gear-fill" viewBox="0 0 16 16">
                                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                                    </svg>
                                </span>
                            </div>                                            
                        </td>
                        <td>Framework Próprio 1</td>
                        <td>Avaliação da maturidade de segurança a partir dos frameworks NIST 2.0 e CIS Controls.</td>
                        <td>CMMI</td>
                        <td>XX.XX.XXXX</td>
                        <td>Empresa - Usuário</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="icon-container" style="display: flex; gap: 10px;">
                                <!-- Botão para abrir o modal editar framework -->
                                <span data-bs-toggle="modal" data-bs-target="#editarFrameworkModal">
                                    <svg class="bi-gear-fill" viewBox="0 0 16 16">
                                        <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                    </svg>
                                </span>
                                <!-- Borão para excluir framework -->
                                <span data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                                    <svg class="bi-gear-fill" viewBox="0 0 16 16">
                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                    </svg>
                                </span>
                                <!-- Botão para abrir o download -->
                                <span id="downloadIcon">
                                    <svg class="bi-gear-fill" viewBox="0 0 16 16">
                                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                                    </svg>
                                </span>
                            </div>                                            
                        </td>
                        <td>Framework Próprio 2</td>
                        <td>Avaliação de Segurança</td>
                        <td>Binário (sim/não)</td>
                        <td>XX.XX.XXXX</td>
                        <td>Empresa - Usuário</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- Modal de Adicionar/Upload--> 
    <div class="modal fade font-small" id="uploadModal" tabindex="-1" aria-labelledby="uploadModal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <header class="modal-title" id="uploadModal">Adicionar Framework</header>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> 
                </div>
                <div class="modal-body font-small mb-2">
                    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate id="uploadForm">
                        {% csrf_token %}
                        {{ form1|crispy }}
                        
                        <span id="infoicon">
                            <svg class="bi-gear-fill" viewBox="0 0 16 16">
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                            </svg>
                            <div class="infobubble">
                                <b>Instruções para planilha </b><br>
                                    O cabeçalho NÃO pode ser alterado <br>
                                    O número de colunas NÂO pode ser alterado <br>
                                    As colunas "Id Controle" e "Controle" são OBRIGATÓRIAS e devem ser PREENCHIDAS <br>
                                    Linhas e colunas NÃO devem ser mescladas <br>
                                    NÃO saltar linhas entre os dados <br>
                                    NÂO começar o preenchimento por uma linha aleatória <br>
                            </div>
                        </span> 

                        <div class="mb-2 d-flex align-items-center font-small">
                            <input type="file" name="excel_file" class="form-control form-control-sm me-2 font-small" id="excelFile" required>
                            <div class="modal-body font-small">
                                <button type="submit" class="btn btn-primary btn-sm font-small">Upload</button>
                                <div class="invalid-feedback font-small">
                                    Por favor, selecione um arquivo.
                                </div>
                            </div>
                        </div>

                        {% if uploaded_file_url %}
                            <p class="mt-2 font-small">Arquivo enviado para: <a href="{{ uploaded_file_url }}">{{ uploaded_file_url }}</a></p>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de confirmação -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <header class="modal-title" id="confirmDeleteModalLabel">Confirmar Exclusão</header>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Deseja excluir este registro?
                </div>
                <div class="modal-footer">
                    <!-- Botão Cancelar -->
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
                    <!-- Botão Excluir -->
                    <button type="button" class="btn btn-danger btn-sm">Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edição -->
    <div class="modal fade" id="editarFrameworkModal" tabindex="-1" aria-labelledby="editarFrameworkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title font-middle">Editar Framework</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="post" id="editarFrameworkForm" class="needs-validation" novalidate>
                        {% csrf_token %}
                        {{ form2|crispy }}

                        <span id="infoicon">
                            <svg class="bi-gear-fill" viewBox="0 0 16 16">
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                            </svg>
                            <div class="infobubble">
                                <b>Instruções para planilha </b><br>
                                    O cabeçalho NÃO pode ser alterado <br>
                                    O número de colunas NÂO pode ser alterado <br>
                                    As colunas "Id Controle" e "Controle" são OBRIGATÓRIAS e devem ser PREENCHIDAS <br>
                                    Linhas e colunas NÃO devem ser mescladas <br>
                                    NÃO saltar linhas entre os dados <br>
                                    NÂO começar o preenchimento por uma linha aleatória <br>
                            </div>
                        </span> 
    
                        <div class="mb-2 d-flex align-items-center font-small">
                            <input type="file" name="excel_file" class="form-control form-control-sm me-2 font-small" id="excelFile" required>
                            <div class="modal-body font-small">
                                <button type="submit" class="btn btn-primary btn-sm font-small">Upload</button>
                                <div class="invalid-feedback font-small">
                                    Por favor, selecione um arquivo.
                                </div>
                            </div>
                        </div>
    
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary btn-sm font-small" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" form="editarFrameworkForm" class="btn btn-success btn-sm font-small">Salvar</button>
                        </div>
        
                        {% if uploaded_file_url %}
                                    <p class="mt-2 font-small">Arquivo enviado para: <a href="{{ uploaded_file_url }}">{{ uploaded_file_url }}</a></p>
                        {% endif %}
                    </form>

                    
            </div>
        </div>
    </div>
</main>
{% endblock %}